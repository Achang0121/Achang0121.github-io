<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="google-site-verification" content="TZE0rZyIqLl10trYu3BWBWa1Vmz6HFwhb2OcNEK4u-s">
     <link rel="shortcut icon" href="/img/favicon.ico">
    <title>
        JMChang的个人博客
    </title>
    <meta name="description" content="嘿，我是阿长～这是我的个人博客，用于记录自己的点滴！">
    <meta name="keywords" content="Blog,Hexo,Python,爬虫,Linux">
    <link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">
    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-home
 replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            Python -- 实现常用的数据结构 -- 堆和优先级队列
        </p>
        <hr>
    </div>
    <div class="post-content">
        <h3 id="什么是堆（heap）？"><a href="#什么是堆（heap）？" class="headerlink" title="什么是堆（heap）？"></a>什么是堆（heap）？</h3><p>堆是一棵完全二叉树，有最大堆和最小堆两种：</p>
<ul>
<li><p>最大堆：对于每个内部节点的值都大于或者等于其子节点的值，也就是说最大值在最上面</p>
</li>
<li><p>最小堆：与最大堆相反，每个内部节点的值小于或者等于其子节点的值，同样意味着最小值在最上面</p>
</li>
</ul>
<a id="more"></a>

<h4 id="最大堆的简单实现"><a href="#最大堆的简单实现" class="headerlink" title="最大堆的简单实现"></a>最大堆的简单实现</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxHeap</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._heap = []</span><br><span class="line">        self._size = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_parent</span><span class="params">(self, j)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (j - <span class="number">1</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_left</span><span class="params">(self, j)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> j * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_right</span><span class="params">(self, j)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> j * <span class="number">2</span> + <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_has_left</span><span class="params">(self, j)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._left(j) &lt; self._size</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_has_right</span><span class="params">(self, j)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._right(j) &lt; self._size</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_swap</span><span class="params">(self, i, j)</span>:</span></span><br><span class="line">        <span class="string">"""交换i和j的值"""</span></span><br><span class="line">        self._heap[i], self._heap[j] = self._heap[j], self._heap[i]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_shiftUp</span><span class="params">(self, j)</span>:</span></span><br><span class="line">        <span class="string">"""将j位置的值与其父节点的值比较，如果j的值大则与父节点交换，递归调用，保持最大堆的特性"""</span></span><br><span class="line">        parent = self._parent(j)</span><br><span class="line">        <span class="keyword">if</span> j &gt;<span class="number">0</span> <span class="keyword">and</span> self._heap[j] &gt; self._heap[parent]:</span><br><span class="line">            self._swap(j, parent)</span><br><span class="line">            self._shiftUp(parent)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_shiftDown</span><span class="params">(self, j)</span>:</span></span><br><span class="line">        <span class="string">"""在j的子节点存在的情况下，将j的值和子节点中较大的值交换，同样是递归调用，同样也是保持最大堆的特性"""</span></span><br><span class="line">        <span class="keyword">if</span> self._has_left(j):</span><br><span class="line">            left = self._left(j)</span><br><span class="line">            bigger = left</span><br><span class="line">            <span class="keyword">if</span> self._has_right(j):</span><br><span class="line">                right = self._right(j)</span><br><span class="line">                <span class="keyword">if</span> self._heap[left] &lt; self._heap[right]:</span><br><span class="line">                    bigger = right</span><br><span class="line">            <span class="keyword">if</span> self._heap[bigger] &gt; self._heap[j]:</span><br><span class="line">                self._swap(j, bigger)</span><br><span class="line">                self._shiftDown(bigger)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">size</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._size</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_empty</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._size == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="string">"""插入元素到堆，并维持最大堆特性"""</span></span><br><span class="line">        self._heap.append(item)</span><br><span class="line">        self._size += <span class="number">1</span></span><br><span class="line">        self._shiftUp(self._size - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""移除堆顶元素并返回，并维持最大堆特性"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.is_empty():</span><br><span class="line">            temp = self._heap[<span class="number">0</span>]</span><br><span class="line">            self._heap[<span class="number">0</span>] = self._heap.pop()</span><br><span class="line">            self._size -= <span class="number">1</span></span><br><span class="line">            self._shiftDown(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> temp</span><br></pre></td></tr></table></figure>

<h4 id="Python中的heapq模块"><a href="#Python中的heapq模块" class="headerlink" title="Python中的heapq模块"></a>Python中的<a href="https://docs.python.org/3.7/library/heapq.html" target="_blank" rel="noopener">heapq模块</a></h4><p>由于文档全英文哈，列举下该模块的一些方法</p>
<table>
<thead>
<tr>
<th>方法</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td>heapq.heappush(heap, item)</td>
<td align="left">将item放入heap，并重新调整heap以满足heap-order属性，函数执行时间复杂度为O(log n)</td>
</tr>
<tr>
<td>heapq.heappop(heap)</td>
<td align="left">弹出并返回堆顶元素，并保持堆满足heap-order属性，函数执行的时间复杂度为O(log n)。如果只是访问堆顶元素，heap[0]即可</td>
</tr>
<tr>
<td>heapq.heappushpop(heap, item)</td>
<td align="left">如果heap不为空，并且item比堆顶的元素大，用item替换堆顶元素，执行下堆操作；返回替换出去的元素。如果item比堆顶元素小，直接返回item。函数执行的时间复杂度为O(log n)。</td>
</tr>
<tr>
<td>heapq.heapreplace(heap, item)</td>
<td align="left">类似heappushpop()，现将heap[0]保存起来，然后将item赋给heap[0]，执行下堆操作并返回之前保存的heap[0]。所以它并不比较待插入的item和当前堆顶元素大小，就算新插入的item是最小，也不能被返回</td>
</tr>
<tr>
<td>heapq.heapify(x)</td>
<td align="left">改变未排序的列表，使其满足heap-order属性。这个函数是自底向上的堆构造算法，时间复杂度为O(n)</td>
</tr>
<tr>
<td>heapq.nlargest(n, iterable, key=None)</td>
<td align="left">从iterable中生产n个最大值的列表并返回。函数执行的时间复杂度为O(n+nlogn)</td>
</tr>
<tr>
<td>heapq.nsmallest(n, iterable, key=None)</td>
<td align="left">从iterable中生成n个最小值的列表并返回</td>
</tr>
</tbody></table>
<p>注：英文一般般，有些看不懂的地方，参照源代码理解了下，说得可能很蹩脚，但是意思应该大差不差的。</p>
<hr>
<h3 id="什么是优先级队列（priority-queue）？"><a href="#什么是优先级队列（priority-queue）？" class="headerlink" title="什么是优先级队列（priority queue）？"></a>什么是优先级队列（priority queue）？</h3><p>包含优先级元素的集合，该集合允许插入任意元素，并允许删除拥有最高优先级的元素。</p>
<h3 id="优先级队列的Python简单实现"><a href="#优先级队列的Python简单实现" class="headerlink" title="优先级队列的Python简单实现"></a>优先级队列的Python简单实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span>:</span></span><br><span class="line">    <span class="string">"""基于最大堆实现优先级队列"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._maxheap = MaxHeap()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, priority, value)</span>:</span></span><br><span class="line">        item = (priority, value)</span><br><span class="line">        self._maxheap.add(item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._maxheap.extract()</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>优先级队列用堆来实现是很方便的，优先级越高的越靠近堆顶。至于用最大堆还是最小堆，视具体情况而定。</p>

    </div>

    
</div>
    <div class="footer" id="footer">
    <p><h4>版权所有 © 2020 | 作者: 阿长 | 主题 By <a class="theme-author" href="https://github.com/Xunzhuo/hexo-theme-coder" style="font-size:14px; color: #969696">Coder</a></h4>
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">本站浏览总访问量: <span id="busuanzi_value_site_pv"></span></span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv">本站访问人数: <span id="busuanzi_value_site_uv"></span></span>
    
    <label class="el-switch el-switch-blue el-switch-sm" style="vertical-align: sub;">
        <input type="checkbox" name="switch" id="update_style">
        <span class="el-switch-style"></span>
    </label>

    <!--         <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
    document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script> -->
</p>
</div>

<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="NOsswOncKgc8HOxqo9oxIWlX-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="z1FihjWEbS8uIfUQdmCtK7zz">
<script src="/libs/jquery.min.js"></script>
<script src="/libs/highlight/highlight.pack.js"></script>
<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>
<script src="/js/js.js"></script>
<style type="text/css">
.v * {
color: #698fca;
}
.v .vlist .vcard .vhead .vsys {
color: #3a3e4a;
}
.v .vlist .vcard .vh .vmeta .vat {
color: #638fd5;
}
.v .vlist .vcard .vhead .vnick {
color: #6ba1ff;
}
.v a {
color: #8696b1;
}
.v .vlist .vcard .vhead .vnick:hover {
color: #669bfc;
}
</style>
    <script type="text/javascript" color="173,174,173" opacity='1' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
